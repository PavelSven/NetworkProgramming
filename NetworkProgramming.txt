				СЕТЕВОЕ ПРОГРАММИРОВАНИЕ.
				
			Введение в Сети.
	Сеть - это набор связанного, активного и пассивного оборудования, при помощи которого компьютеры и другие
устройства могут взаимодействовать на расстоянии. Так же как и обычный компьютер сеть состоит из аппаратной
части и программного обеспечения. Аппаратной частью сети является базовая технология. Роль программной части
выполняет стек протоколов. Базовая технология представляет собой набор активного и пассивного оборудования.
Под активным оборудованием понимается все, что может генерировать сигнал. К пассивному оборудовнию относится
то, через что передаются эти сигналы, - это разъмы, кабели, антенны и т.д.

		Активное оборудование.
	Активное сетевое оборудование можно разделить на оконечное и промежуточное. Оконочное оборудование еще 
называют хостами, или узлами, сети. Как правило, это мобильный телефон или компьютер, но к локальной 
вычислительной сети можно подключить все, что угодно - сканеры, принтеры, камеры, кофеварка. 
Хосты являются клиентами локальной сети. К промежуточному активному оборудованию можно отнести коммутаторы,
маршрутизаторы, беспроводные точки доступа, повторители и медиаконвертеры.
	Коммутатор (switch) - это устройство, которое связывает компьютеры в локальную сеть. Коммутатор ретранслирует
Ethernet-кадры с одного порта на другой. Сеть, созданная при помощи коммутаторов, имеет звездную архитектуру.
Коммутатор определяет на какой порт отправить кадр по MAC-адресу (физический адрес). Максимальный размер
Ethernet-кадра по-умолчанию составляет 1500 байт, его можно изменить через реест Windows. На коммутаторах
можно построить одноранговую сеть, в которой каждый узел будет на равных правах. Коммутаторы бывают на 
5, 8, 12, 16, 24, 28, 48, 96 портов. Лучшими производителями являются Cisco, HP (Hewkett Packard), Zyxel, Mikrotik.
	MAC-адреса имеют плоскую неиеархическую структуру, поэтому исключительно на MAC-адресах невозможно 
построить составную сеть, которая будет поделена на разные сети. В иеархических сетях используется IP-адреса.
И для построения составных сетей используются маршрутизаторы. Маршрутизатор (Router) - это устройство,
которое объединяет сети. На маршрутизаторах построена сеть Internet. Internet - это составная сеть,
состоящая из множества локальных и глобальных сетей. Маршрутизатор перенаправляет IP-пакет в сеть назначения.
Для того, чтобы определить сеть назначения у маршрутизатора есть таблица маршрутизаций, по которой протокол IP
определяет на какой порт и какую сеть переслать IP-пакет.
	Беспроводныя точка доступа (HotSpot) - это устройство, которое дает доступ беспроводным клиентам в проводную
локальную сеть. Как правило, точки доступа поддерживают технологию POE - Power Over Ethernet, позволяющая
подавать питание на устройство прямо по кабелю передачи данных. Для этого данную технологию должен поддерживать
коммутатор. Технология POE используется не только здесь, а еще и в IP-камерах, IP-телефонах.
	Обычный домащний WiFi-роутер объединяет в себе три устройства - коммутатор, маршрутизатор, беспроводную
точку доступа. А благодаря технологии VLAN (Virtual Local Area Network) позволяет очень гибкую настройку,
добавляя возможности маршрутизации. Пример: Keenetic.
	Повторитель (Repeater) - устройство, которое усиливает сигнал.
	Медиаконвертер позволяет преобразовывать сигнал из одной среды в другую, как правило, оптический в электрический.
	
		Пассивное оборудование.
	Основным пассивным оборудованием являются кабели. Они позволяют передавать сигнал на большие расстояния.
Но сам кабель невозвожно подключить к устройству. Он подключается через разъем. 
	Основным разъемом для медных кабелей является RJ-45. Для построения локальной сети, как правило, 
используются медные кабели типа UTP (Unshielded Twisted Pair) - неэкранированная витая пара. Это восьмижильный 
кабель в резиновой оплетке. Кроме UTP также существуют кабели FTP/STP/SFTP. Это все экранированные кабели. 
Современные технологии локальных сетей позволяют передавать данные по медному кабелю не более, чем на 100 метров.
	Fiber - волоконно-оптический кабель - основным преимуществом ВОЛС (Волоконно-оптическая линия связи) перед
медными кабелями является расстояние по которым передаются данные. Существуют две разновидности ВОЛС:
	MMF (Multi-Mod Fiber - многомодовое оптоволокно) - позволяет по одной жиле передавать множество сигналов 
от разных источников в обоих направлениях. По такому кабелю можно передавать данные на расстояние в 500 м. 
Источником сигнала являются светодиоды.
	SMF (Single-Mod Fiber - одномодовое оптоволокно). По одной оптической жиле можно передать сигнал лишь
от одного источника и в одном направлении, но SMF может передавать этот сигнал на километры и десятки километров.
Для одновремеенной передачи сигналов в обоих направлених к устройству подводится 2 жилы на приём и на передачу.
В современных базовых технологиях, как правило, используются SMF кабели.

	При выборе волоконно-оптического оборудования как кабелей так и активного оборудования очень пристальное
внимание нужно обращать на окна прозрачности, в которых работает это оборудование. Это может быть 1300 нм, 1350 нм,
1500 нм ...


			Базовые технологии.
	Базовая технология - это стандарт или семейство стандартов, которое описывает активное и пассивное оборудование
для построения локальной сети. Также базовая технология опеределяет формат MAC-адресов и формат кадров, передаваемых
по сети. 
	
	Наиболее распространенной базовой технологией на сегодня является Ethernet.
	Ethernet - это семейство базовых технологий, которая включает в себя классический Ethernet, который передает данные
на скорости 10 Mbps (Мбит/с).
	Fast Ethernet - 100 Mbps.
	Gigabit Ethernet - 1000 Mbps. 
	2.5, 5, 10 Gigabit Ethernet.
	Каждая сетевая технология включает в себя несколько спецификаций. Спецификация определяет типы кабелей и разъемов
для построения сети. Например, у Gigabit Ethernet есть спецификация 1000 Base-T, в которой используется кабель
UTPcat5e (UTP категории 5е), причем кабель обязательно должен быть 4-х парных (8-ми жильным), поскольку в 100 Base-T
передача сигнала ведется одновремеенно по 4-ем парам в обоих направлениях. Только таким образом была достигнута
скорость 1000 Mbps.
1000 Base-SX(LX) - это волоконно-оптическая.
	Во всем семействе технологий Ethernet используется единый формат кадра, передаваемого по сети.
Ethernet-кадр, как любое другое PDU, состоит из заголовка и поля данных. Заголовок состоит из 3 полей:
DST-MAC, SRC-MAC, Proto.
	DST-MAC (Destination MAC-address - MAC-адрес получателя) - по этому адресу коммутатор определяет на какой конкретный
порт перенаправить данный кадр.
	SRC-MAC (Source MAC-address - МАС-адрес источника) - коммутатор запоминает этот адресс и привязывает его
к определенному потоку в МАС-адресной таблице. МАС-адресная таблица хранится в оперативной памяти коммутатора
и строится на время сеанса его работы.
	Proto - это тип протокола верхнего уровня, который вкладывается в поле данных Ethernet-кадра. Как правило,
содержит значение 0x800 (IP).

	МАС-адрес или физический адрес присваивается непосредственно сетевой карте заводом изготовителя.
МАС-адрес это число длиной 6 байт, записанное в 16-ичной системе счислений, в котором старшие 3 байта
это ID производителья, а младшие 3 байта - серийный номер сетевой карты. МАС-адрес всегда можно узнать при помощи
комманды getmac /v /fo list или ipconfig. МАС-адрес также можно изменить в операционной системе через настройки
драйвера.

			Сетевые модели.
	Большинство сетей построены в соответствии с какой то моделью. 
	Самая первая - ISO/OSI (Open System Interconnection). Это семиуровневая модель, выделяющая ключевые компоненты 
сетевого взаимодействия. Состоит из следующих уровней:
	7 - Application (Прикладной уровень)
	6 - Presentation (Представительный)
	5 - Session (Сеансовый)
	4 - Transport (Транспортный)
	3 - Network (Сетевой)
	2 - Data link (Канальный)
	1 - Physical (Физический).
	Каждый из этих уровней отвечает за определенную задачу сетевого взаимодействия. Например, физический отвечает
за передачу битов данных по физическим каналам связи. Канальный определяет формат передаваемых кадров,
формат адреса в единой среде. Первые два уровня, как правило, реализованы в базовой сетевого технологии (Ethernet,
WiFi и т.д.). Сетевой уровень отвечает за объединение сетей, универсальную адресацию в составной сети и маршрутизацию
пакетов из одной сети в другую. Транспортный уровень отвечает за доставку данных приложению в пределах узла.
Сеансовый уровень отвечает за надежность доставки данных. И при потере информации в сети занаво ее передает.
Представительный уровень представляет в едином формате сообщений от разных протоколов прикладного уровня.
Прикладной уровень взаимодействует непосредственно с приложениями на компьютере.
	На оконечных узлах реальзованы все уровни модели OSI. На коммутаторах - 2 уровня, на маршрутизаторах - 3.
	Модель OSI вводит такие важнейшие понятия как протокол и интерфейс.
	Protocol - формализованные правила взаимодействия сетевых компонент одного уровня на разных узлах сети.
	Interface - формализованные правила взаимодействия сетевых компонент соседних уровней в пределах одного узла.

	Модель OSI имеет обобщенный характер, как ООП может быть реальзована по разному на разных языках программирования.
Реализацией сетевой модели является стек протоколов, которые реализуют программную часть модели OSI.
Аппаратную же часть реализуют базовые технологии. Стек протоколов - это иеархический набор протоколов, каждый
из которых выполняет свою задачу и строго взаимодействует с другими протоколами соседних уровней или на своем уровне.
Существует стек протоколов OSI, но он так и не получил широкого распространения. Также существуют и другие стеки
протоколов, например: IPX/SPX, но наибольшее распространение получил стек протоколов TCP/IP, поскольку именно на нем
построена всемирная составная сеть Internet. На сегодня используются две версии стека TCP/IP, каждая из которых
определяется версией основного протокола в стеке: IPv4, IPv6. Главным отличием между 4 и 6 версией является
длина и формат адреса. Стек протоколов TCP/IP был разработан министерством обороны США в 1979г. 
TCP/IP состоит из 4 уровней, пронумерованных сверху вниз.
	Уровни:
	1. Application (Прикладной уровень). 
	   Протоколы: DHCP, DNS, NetBIOS, NFS, Telnet, SSH, FRP/TFTP, HTTP, SNMP, SMTP, POP-3/IMAP-4.
	2. Main (Transport, основной или транспортный)
	   Протоколы: TCP, UDP.
	3. Internetwork communication (Межсетевое взаимодействие)
	   Протоколы: IP, ARP, ICMP, IGRP, RIP, OSPF.
	4. Network Interfaces (Сетевые интерфейсы)
	   Протоколы: Ethernet, Wi-Fi, G-PON.

		Internetwork communication.
	Главным протоколом в стеке TCP/IP является IP (Internet Protocol) - протокол межсетевого взаимодействия.
Протокол IP описывает формат адреса, формат IP-пакета, способы деления адреса на номер сети и номер узла.
	Протокол ARP (Address Resolution Protocol) - протокол разрешения адресов. ARP по заданному IP-адресу
находит MAC-адрес, на который нужно отправить IP-пакет. MAC-адрес нужен коммутатору для того, чтобы понять
на какой порт перенаправить Ethernet-кадр с нашим IP-пакетом. Найденный MAC-адрес вкладывается в заголовок 
Ethernet-кадра как адрес получателя. У протокола ARP есть локальный кэш, на который он сохраняет все найденные
MAC-адреса. В операционной системе Windows если запись из кэша не использовалась 2 минуты, она удаляется.
	ICMP (Internet Control Message Protocol) - протокол межсетевых управляющих сообщений. Используется для диагностики
сети и отправки сообщений об ошибках. Комманды диагностики: ping, tracert (traceroute). ping - проверяет наличие 
соединения с заданным узлом, для этого используются сообщения ICMP Type 8 - Echo request, ICMP Type 0 - Echo reply.
tracert - проверяет маршрут до узла назначения. Маршрут - последовательность маршрутизаторов, через которые
проходит IP-пакет до узла получателя. Протокол ICMP часто закрывают при помощи firewall как на оконечных узлах так
и на маршрутизаторах.
	IGRP, RIP, OSPF - протоколы маршрутизации. Они строят маршрут до сети назначения, а точнее строят не сам
маршрут, а таблицу маршрутизации, в которой прописано к какому следующему маршрутизатору перенаправить IP-пакет,
чтобы он приблизился к сети назначения. Протоколы маршрутизации не пересылают IP-пакеты, они просто строят маршрут.
Пакеты пересылает протокол IP. Основной задачей протокола IP является доставка пакета до узла назначения.

		Main(Transport).
	Основной задачей протоколов транспортного уровня является доставка сегмента с данными до приложения в пределах
узла. Для этого протоколы транспортного уровня TCP/UDP используют номера портов, то есть номер порта - это адрес
приложения в пределах узла (host/устройство). Всего портов 65 536, из которых первые 1024 это общеизвестные порты
(Well knows ports), используемые, как правило, серверными приложениями и распространенными протоколами прикладного уровня.
Например, протокол HTTP использует 80 порт протокола TCP, следовательно web-сервер всегда работает на 80 порту
протокола TCP. Следует понимать, что 80 порт TCP и 80 порт UDP это два совершенно разных порта. Если какой-то порт
уже использует какое-то приложение, то другие приложения уже не могут использовать этот порт. Все занятые на данный
момент порты можно посмотреть при помощи команды netstat. Если приложение запускается на каком-то порту,
то оно постоянно прослушивает этот порт. Если к порту подключился какой-то узел, значит установилось соединение
и у него будет статус ESTABLISHED. При закрытии соединение переходит из одного статуса в другой. Гораздо удобнее
просматривать статус соединений при помощи утилиты TCPview. Абсолютно все номера портов, зарегистрированых
в системе, можно посмотреть в файле Windows: %SYSTEMROOT%\System32\drivers\etc\services  (%SYSTEMROOT% это папка Windows),
UNIX: /etc/services. Номера портов так же, как и номера протоколов и прочие сетевые номера распределяет международная
организация IANA (Internet Assigned Numbers Authority). 
	TCP (Transmission Control Protocol) - протокол управления передачей. Работает с установкой виртуального
соединения и благодаря этому обеспечивает надежный обмен данными между узлами. Но виртуальное соединение
замедляет передачу данных, поскольку происходит обмен служебной информации, а также соединению нужно выдерживать
тайм-аут. Протокол TCP, как правило, используют для передачи трафика, чувствительного к потерям, но не чувствительного
к задержкам. Это передача файлов, веб-страниц, текстовой информации, изображений...
	Для передачи трафика, чувствительного к задержкам, но не к потерям, например голос или видео,
используется протокол UDP (User Datagram Protocol) - протокол пользовательских датаграмм. Он не устанавливает
виртуальных соединений, за счет чего обеспечивает низкую задержку при передаче данных. Но часть данных может
быть потерена. UDP, как правило, используют для передачи голоса.
	Протоколы стека TCP/IP подробнейшим образом описаны в нормативных документах в RFC (Request For Comment).
У каждого RFC есть свой номер. В одном RFC описан только один протокол. Некоторые протоколы описаны несколькими RFC,
поскольку протоколы обновляются и обновленная версия описана в новом RFC. RFC издаются компанией IETF (Internet
Engineering Task Force)
		
		Application.
	DHCP (Dynamic Host Configuration Protocol) - протокл динамической конфигурации узлов. Автоматически выдает
настройки протокола IP (маска, шлюз,...) к узлам сети.
	DNS (Domain Name System) - система доменных имен. Преобразует доменные имена в IP-адреса.
	FTP (File Transfer Protocol) - протокол передачи файлов. На транспортном уровне используют протокол TCP.
	TFTP (Trivial File Transfer Protocol) - простой протокол передачи файлов. На транспортном уровне используют
протокол UDP.
	HTTP (Hyper-Text Trasfer Protocol) - протокол передачи гипер-текста. Используется для обмена данными
между браузером и веб-сервером.
	Telnet - протокол удаленного управления. Позволяет выполнять команды на консоли удаленного компьютера. DEPRECATED.
Главным недостатком является то, что всю информацию он передает в открытом виде, включая учетные данные.
Эти недостатки устраняет протокол SSH.
	SSH (Secure Shell) - делает то же самое, что и Telnet, но по надежно зашифрованным каналам.

	PDU (Protocol Data Unit) - блок данных, с которым работают протоколы определенного уровня.
	Application level - Message;
	Transport level	  -	Segment;
	Network level	  -	Packet;
	Network interface -	Frame (кадр);
	Psysical level	  - bit;

При отправке сообщения происходит процедура инкапсуляции, т.е. PDU верхнего уровня упаковывается в поле данных
PDU нижнего уровня. Сообщение разбивается на сегменты, каждому сегменту приклепляется TCP или UDP заголовок.
И вся эта структура данных вкладывается в поле данных IP-пакета. Когда IP-пакет готов, он упаковывается в поле
данных Ethernet-кадра, а он побитого отправляется в сеть. Когда весь этот блок данных дошел до получателя,
происходит обратная процедура - декапсуляция. После того, как сетевая карта прочита Ethernet-заголовок
он удаляется, а поле данных отправляется наверх протоколу IP. После того, как протокол IP прочитал свои данные,
он удаляет заголовок и отправляет поле данных наверх протоколу TCP или UDP. Эти протоколы делают то же самое и
уже протокол прикладного уровня собирает сегменты в сообщение.

		
			Адресация в IP-сетях.
	Одной из основных сущностей протокола IP является IP-адрес - это число, длиной 4 байта, которое уникально
идентифицирует узел составной сети. IP-адрес обычно записывают в точечно-десятичной нотации, т.е. каждый
байт IP-адреса записывается в 10-ой системе счисления, байты разделяются между собой точками.
Одним из основных свойств является иеархичность, т.е. он делится на номер сети и номер узла. Существует
3 способа деления:
	1. Безклассовая адресация. Старшие 2 байта всегда нумеруют сеть, а младшие - узел сети.
Недостаток - нерациональное использование IP-адресов.

	2. Классовая адресация. Все адреса разделены на классы: a, b, c, d, e. В каждом классе отводилось разное
количество байт. Классы отличались между собой по префиксу старшего байта в двоичной системе счисления.
	A - старший байт - префикс 0 (0000 0000). Диапазон: от 0000 0001 по 0111 1111. Это определяло диапазон адресов 
от 1.0.0.0 по 126.255.255.255. Формат адреса N.H.H.H. Класс включал в себя 126 сетей по 16 777 216 адресов. 
Маска по умолчанию 255.0.0.0. 127 сеть зарезервирована для Localhost (Loopback) 127.0.0.1.
	B - префикс 10 (1000 0000). Диапазон старшего байта от 1000 0000 по 1011 1111. Диапазон адресов от 128.0.0.0
по 191.255.255.255. В классе для адресации сетей отводится 2 старший байта, а узлов - 2 младший байтов.
Формат адреса N.N.H.H. Класс включает в себя 16 384 сетей по 65 536 адресов. Маска по умолчанию
255.255.0.0.
	C - префикс 110 (1100 0000). Диапазон старшего байта от 1100 0000 по 1101 1111. Диапазон адресов от
192.0.0.0 по 223.255.255.255. Для номера сети отводится 3 старших байта и только один младший байт - для
нумерации узлов N.N.N.H. Класс включает в себя 2 097 152 по 256 узлов. Маска по умолчанию - 255.255.255.0.
	D - используется для широковещательного трафика.
	E - зарезервирован и не используется нигде.
	
	3. Со временем потребность в IP-адресах увеличилась и понадобилась еще более гибкий способ разделения 
IP-адреса на номер сети и номер узла. И это были маски.
	Маска - это число, которое используется в паре с IP-адресом и показывает какие биты адресов отводятся
под номер сети, а какие - под номер узла. В отличие от классов, которые позволяли отводить байты под нумерацию
сетей и узлов, маски позволяют отводить отдельные биты под номер сети и номер узла. Те биты адреса, которые
в маске равны 1, нумеруют сеть. А те биты, которые в маске равны 0, нумеруют узлы. Единицы могут быть
только в старшей непрерывной области маски, а нули могут занимать только младшую непрерывную область маски.
Кроме точечно-десятичной нотации маски также часто записывают в сокращенном виде. Такая запись показывает
количество бит адреса, отведенных под номер сети.

		Особые IP-адреса.
	Не все адреса можно присвоить узлам, поскольку некоторые из них имеют особое значение.
	1. 0.0.0.0 - означает все IP-адреса. Используется на firewall, маршрутизаторах и при настройке доступа
к серверу. Если сервер запущен на всех интерфейсах, то он будет прослушивать этот адрес.
	2. 255.255.255.255 - широковещательный адрес. Пакет с таким адресом назначения получат абсолютно 
все узлы локальной сети. Широковещательный адрес - это адрес, у которого все биты установлены в 1.
FF:FF:FF:FF:FF:FF.
	3. Адрес сети - это IP-адрес, у которого все биты, отвечающие за нумерацию узлов сброшены (равны 0).
Адрес сети невозможно присвоить интерфейсу. Адрес сети можно легко получить побитовым умножением
IP-адреса на маску.
	4. Широковещательный адрес в заданную сеть - IP-адрес, у которого все биты, отвечающие за нумерацию
узлов установлены в 1.
	5. 127.0.0.1 - Localhost (Loopback).
	
	По той причине, что абсолютно у каждой сети есть свой адрес и широковещательный адрес, количество адресов,
которые можно назначить узлам, всегда на 2 меньше.

		Автономные IP-адреса.
	Предназначены для использования исключительно в локальных сетях. Никогда не используются в сети
Internet. Также называют серыми адресами, а в Internet используются белые адреса, которые распределяются
организацией IANA, между национальными провайдерами, а они распределяют адресное пространство между
остальными провайдерами. Автономные адреса есть в каждом классе. В классе А - это вся сеть 10.0.0.0 /8.
Класс B - 172.16.0.0 ... 172.31.0.0 /16. C - 192.168.0.0 ... 192.168.255.0 / 24. Кроме автономный IP-адресов
также есть Link-local address 169.254.0.0 /16. Адрес из этой сети автоматически назначается интерфейсом,
которые не получили адрес другим способом (ручной настройкой или DHCP) для того, чтобы поднять между
компьютерами локальную сеть и запустить сетевое окружение. Автономные адреса позволяют в значительной
степени сэкономить IP-адресное пространство и задействовать больше адресов в сети интернет.
При использовании таких адресов на маршрутизаторе обязательно должна работать служба NAT - Network 
Address Translation. Эта служба работает на внещнем порту маршрутизатора и подменяет внутренние автономные
адреса IP-адресом порта, на котором она работает. Благодаря этой службе сеть любых масштабов подключается
к Internet всего одним IP-адресом.


			Сетевые возможности Windows.
	В операционной системе Windows сетевые возможности реализованы в библиотеке WinSock (Windows Sockets).
Актуальная версия WinSock2. Сама библиотека реализована в файле WSOCK32.DLL. 
	Socket - совокупность IP-адреса и порта TCP/UDP. 
